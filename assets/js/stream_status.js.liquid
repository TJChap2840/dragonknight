---
---

// function getStatus() {
//   {% for streamer in site.data.streamers %}
//     if ("{{streamer.service}}" == "twitch") {
//       checkTwitch("{{streamer.name}}", "{{streamer.url}}");
//     } else {
//       checkHitbox("{{streamer.name}}", "{{streamer.url}}");
//     }
//   {% endfor %}
// }

function getStatus() {
  {% for streamer in site.data.streamers %}
    checkTwitch("{{streamer.name}}", "{{streamer.url}}");
  {% endfor %}
}

function checkHitbox(container, url) {
  $.ajax({
    url: url,
    dataType: 'json',
    success: function(data) {
      var status = "OFFLINE";
      document.getElementById(container).style.background = "#ffe5e5";
      document.getElementById(container).href = data.livestream[0].channel.channel_link;
      if (data.livestream[0].media_is_live == 1) {
        status = "LIVE";
        document.getElementById(container).style.background = "#c5ecc5";
        document.getElementById(container + "Title").innerHTML = "<em>" + data.livestream[0].media_status + "<em>";
        document.getElementById(container + "Game").innerHTML = "Playing <b>" + data.livestream[0].category_name + "</b>";
      }
      document.getElementById(container + "Status").innerHTML = status;
      // alert("success")
    },
    error: function(data) {
      // alert("error");
    }
  })
}

function checkTwitch(container, url) {
  $.ajax({ 
    url: url,
    dataType:'jsonp',
    success: function(data) { 
      var channel = data._links.channel;
      $.ajax({
        url: channel,
        dataType: 'jsonp',
        success: function(channel_info) {
          document.getElementById(container).href = channel_info.url;
        }
      });
      var status = "OFFLINE";
      document.getElementById(container).style.background = "#ffe5e5";
      if (data.stream != null) {
        status = "LIVE";
        document.getElementById(container).style.background = "#c5ecc5";
        document.getElementById(container + "Title").innerHTML = "<em>" + data.stream.channel.status + "<em>";
        document.getElementById(container + "Game").innerHTML = "Playing <b>" + data.stream.game + "</b>";
      } 
      document.getElementById(container + "Status").innerHTML  = status
    }
 });
}
